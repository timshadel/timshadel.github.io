---
title: Customize Rails Validation HTML Using Hpricot
author: Tim
layout: post
redirect_from: /2007/02/06/customize-rails-validation-html-using-hpricot/
categories:
  - How-To
---
This morning I experimented a bit with overriding the default HTML generated by validation errors in Rails. Instead of wrapping the `<input>` tag inside a `<div class="fieldWithErrors">` indiscriminately (which was breaking the layout I wanted), I wanted to simply inject a new CSS class onto the HTML element.

I found one email showing <a href="http://lists.rubyonrails.org/pipermail/rails/2006-February/020505.html" target="_blank">how to use regular expressions</a> to get the job done. It may work, but I wanted something that seemed a little less blunt. I&#8217;ve also been playing around with <a href="http://code.whytheluckystiff.net/hpricot/" target="_blank">Hpricot</a> lately as well. So I decided to try to combine the two. Here&#8217;s the first draft of what I came up with:

{% highlight ruby %}
require 'hpricot'

Rails::Initializer.run do |config|
  . . .
  ActionView::Base.field_error_proc = Proc.new do |html_tag, instance|
    doc = Hpricot(html_tag)
    elem = (doc/"/").first
    css_class = elem.attributes['class']
    css_class ||= ""
    css_array = css_class.split(" ")
    css_array << "fieldWithErrors"
    elem.attributes['class'] = css_array.uniq.join(" ")
    doc.to_s
  end
end
{% endhighlight %}

I then changed the CSS ever so slightly from the default scaffold.css:

{% highlight css %}
.fieldWithErrors {
  border-color: red;
  background-color: #ffcccc;
}
{% endhighlight %}

The result looks like this:


<p>
  <img src="http://timshadel.com/wp-content/uploads/2007/02/381787197_a0d75a13ee_o_d.png" alt="Rails form with custom CSS class on model validation failure." />
</p>


The layout I had before is completely preserved, and I have the chance to color the input the way I want.  I haven&#8217;t tried it with a <code>&lt;textarea></code>.  Also, I tried to adjust for the possibility of other CSS classes already existing on the element, but I&#8217;ve only checked it in <code>irb</code>.  Let me know if you&#8217;ve got improvements to this approach; I&#8217;d love to hear &#8216;em.

